<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mijn Profiel - TaxiToday.nl</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="font-sans antialiased text-gray-800 bg-gray-100">
    <!-- Header -->
    <header class="bg-white shadow-sm sticky top-0 z-50">
        <div class="container mx-auto px-4 py-3 flex justify-between items-center">
            <div class="flex items-center">
                <a href="index.html" class="text-2xl font-bold text-blue-600 flex items-center">
                    <img src="uploads/TaxiToday Logo.png" alt="TaxiToday" class="h-10 mr-2">
                    <span>Taxi<span class="text-blue-800">Today</span></span>
                </a>
                <span class="ml-2 text-sm bg-blue-100 text-blue-800 px-2 py-1 rounded">NL</span>
            </div>
            
            <nav class="hidden md:flex space-x-8">
                <a href="index.html#pricing" class="nav-link font-medium hover:text-blue-600">Prijzen</a>
                <a href="index.html#service" class="nav-link font-medium hover:text-blue-600">Service</a>
                <a href="index.html#about" class="nav-link font-medium hover:text-blue-600">Over ons</a>
                <a href="index.html#contact" class="nav-link font-medium hover:text-blue-600">Contact</a>
                <a href="#" class="nav-link font-medium text-blue-600">Mijn Profiel</a>
                <button class="nav-link font-medium hover:text-red-600 logout-btn">
                    <i class="fas fa-sign-out-alt mr-1"></i> Uitloggen
                </button>
            </nav>
            
            <div class="flex items-center space-x-4">
                <a href="tel:+31202613210" class="hidden md:flex items-center text-blue-600 font-medium">
                    <i class="fas fa-phone-alt mr-2"></i>
                    020 261 32 10
                </a>
                <button class="md:hidden text-gray-600" id="mobileMenuBtn">
                    <i class="fas fa-bars text-2xl"></i>
                </button>
            </div>
        </div>

        <!-- Mobile menu -->
        <div id="mobileMenu" class="hidden md:hidden bg-white py-2 px-4 shadow-lg">
            <a href="index.html#pricing" class="block py-2 hover:text-blue-600">Prijzen</a>
            <a href="index.html#service" class="block py-2 hover:text-blue-600">Service</a>
            <a href="index.html#about" class="block py-2 hover:text-blue-600">Over ons</a>
            <a href="index.html#contact" class="block py-2 hover:text-blue-600">Contact</a>
            <a href="#" class="block py-2 text-blue-600">Mijn Profiel</a>
            <button class="block py-2 hover:text-red-600 w-full text-left logout-btn">
                <i class="fas fa-sign-out-alt mr-1"></i> Uitloggen
            </button>
            <a href="tel:+31202613210" class="block py-2 text-blue-600 font-medium">
                <i class="fas fa-phone-alt mr-2"></i>
                020 261 32 10
            </a>
        </div>
    </header>

    <!-- Profile Section -->
    <section class="py-16">
        <div class="container mx-auto px-4">
            <div class="max-w-5xl mx-auto">
                <div class="flex flex-col md:flex-row gap-8">
                    <!-- Sidebar -->
                    <div class="w-full md:w-1/3">
                        <div class="bg-white rounded-xl shadow-md overflow-hidden p-6">
                            <div class="text-center mb-6">
                                <div class="inline-block rounded-full bg-blue-100 p-4 mb-4">
                                    <i class="fas fa-user text-4xl text-blue-600"></i>
                                </div>
                                <h2 id="profile-name" class="text-xl font-bold">Laden...</h2>
                                <p id="profile-email" class="text-gray-600">Laden...</p>
                            </div>
                            
                            <div class="border-t border-gray-200 pt-4">
                                <nav>
                                    <button class="flex items-center w-full py-2.5 px-4 rounded transition-colors mb-1 bg-blue-50 text-blue-700 font-medium">
                                        <i class="fas fa-tachometer-alt mr-3 w-5 text-center"></i>
                                        Dashboard
                                    </button>
                                    <button class="flex items-center w-full py-2.5 px-4 rounded transition-colors mb-1 hover:bg-gray-50">
                                        <i class="fas fa-user-circle mr-3 w-5 text-center"></i>
                                        Mijn Gegevens
                                    </button>
                                    <button class="flex items-center w-full py-2.5 px-4 rounded transition-colors mb-1 hover:bg-gray-50">
                                        <i class="fas fa-history mr-3 w-5 text-center"></i>
                                        Boekingsgeschiedenis
                                    </button>
                                    <button class="flex items-center w-full py-2.5 px-4 rounded transition-colors mb-1 hover:bg-gray-50">
                                        <i class="fas fa-credit-card mr-3 w-5 text-center"></i>
                                        Betalingsmethoden
                                    </button>
                                    <button class="flex items-center w-full py-2.5 px-4 rounded transition-colors mb-1 hover:bg-gray-50">
                                        <i class="fas fa-cog mr-3 w-5 text-center"></i>
                                        Instellingen
                                    </button>
                                    <button class="flex items-center w-full py-2.5 px-4 mt-6 rounded bg-red-50 text-red-600 hover:bg-red-100 transition-colors logout-btn">
                                        <i class="fas fa-sign-out-alt mr-3 w-5 text-center"></i>
                                        Uitloggen
                                    </button>
                                </nav>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Main Content -->
                    <div class="w-full md:w-2/3">
                        <!-- Welcome Card -->
                        <div class="bg-white rounded-xl shadow-md overflow-hidden p-6 mb-6">
                            <div class="flex justify-between items-start">
                                <div>
                                    <h1 class="text-2xl font-bold mb-2">Welkom terug, <span id="welcome-name">daar!</span></h1>
                                    <p class="text-gray-600">Beheer uw account en bekijk uw boekingen.</p>
                                </div>
                                <div class="text-right">
                                    <span class="inline-block bg-blue-100 text-blue-800 text-sm font-medium rounded-full px-3 py-1">Verified Account</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Quick Actions -->
                        <div class="bg-white rounded-xl shadow-md overflow-hidden p-6 mb-6">
                            <h2 class="text-xl font-bold mb-4">Snelle Acties</h2>
                            <div class="grid grid-cols-2 md:grid-cols-3 gap-4">
                                <a href="index.html#booking" class="flex flex-col items-center p-4 border border-gray-200 rounded-lg hover:bg-blue-50 hover:border-blue-200 transition-colors">
                                    <i class="fas fa-taxi text-2xl text-blue-500 mb-2"></i>
                                    <span class="text-center font-medium">Nieuwe Taxi Boeken</span>
                                </a>
                                <button class="flex flex-col items-center p-4 border border-gray-200 rounded-lg hover:bg-blue-50 hover:border-blue-200 transition-colors">
                                    <i class="fas fa-phone-alt text-2xl text-blue-500 mb-2"></i>
                                    <span class="text-center font-medium">Bel Centrale</span>
                                </button>
                                <button class="flex flex-col items-center p-4 border border-gray-200 rounded-lg hover:bg-blue-50 hover:border-blue-200 transition-colors">
                                    <i class="fas fa-user-edit text-2xl text-blue-500 mb-2"></i>
                                    <span class="text-center font-medium">Profiel Bijwerken</span>
                                </button>
                            </div>
                        </div>
                        
                        <!-- Recent Bookings -->
                        <div class="bg-white rounded-xl shadow-md overflow-hidden p-6">
                            <div class="flex justify-between items-center mb-4">
                                <h2 class="text-xl font-bold">Recente Boekingen</h2>
                                <button class="text-blue-600 hover:text-blue-800 transition-colors">
                                    <i class="fas fa-refresh mr-1"></i> Vernieuwen
                                </button>
                            </div>
                            
                            <div id="bookings-container" class="space-y-4">
                                <div class="text-center py-6 text-gray-500">
                                    <i class="fas fa-spinner fa-spin text-3xl mb-3"></i>
                                    <p>Boekingsgeschiedenis laden...</p>
                                </div>
                            </div>
                            
                            <!-- Booking template (hidden, used by JavaScript) -->
                            <template id="booking-template">
                                <div class="border border-gray-200 rounded-lg p-4 hover:bg-gray-50 transition-colors">
                                    <div class="flex flex-col md:flex-row justify-between">
                                        <div class="mb-2 md:mb-0">
                                            <div class="flex items-center">
                                                <span class="status-indicator w-3 h-3 rounded-full mr-2"></span>
                                                <h3 class="font-medium booking-id">TX-123456</h3>
                                            </div>
                                            <p class="text-sm text-gray-500 booking-date">1 juni 2024, 14:30</p>
                                        </div>
                                        <div class="md:text-right">
                                            <span class="booking-price font-semibold">€55,00</span>
                                        </div>
                                    </div>
                                    <div class="mt-3">
                                        <div class="flex">
                                            <i class="fas fa-circle text-blue-500 text-xs mt-1.5 mr-3"></i>
                                            <div>
                                                <p class="text-sm text-gray-600">Ophalen</p>
                                                <p class="font-medium booking-pickup">Amsterdam Central Station</p>
                                            </div>
                                        </div>
                                        <div class="ml-2 border-l border-dashed border-gray-300 pl-4 py-1 my-1"></div>
                                        <div class="flex">
                                            <i class="fas fa-map-marker-alt text-red-500 mr-3"></i>
                                            <div>
                                                <p class="text-sm text-gray-600">Bestemming</p>
                                                <p class="font-medium booking-destination">Schiphol Airport</p>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="mt-4 pt-3 border-t border-gray-200 flex justify-between items-center">
                                        <span class="booking-status px-3 py-1 rounded-full text-xs font-medium"></span>
                                        <div>
                                            <button class="text-blue-600 hover:text-blue-800 px-3 py-1 rounded mr-1 hover:bg-blue-50 transition">
                                                <i class="fas fa-eye mr-1"></i> Details
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </template>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="bg-gray-900 text-white py-8">
        <div class="container mx-auto px-4">
            <div class="md:flex md:justify-between">
                <div class="mb-6 md:mb-0">
                    <a href="index.html" class="text-2xl font-bold text-white flex items-center">
                        <img src="uploads/TaxiToday Logo.png" alt="TaxiToday" class="h-10 mr-2">
                        <span>Taxi<span class="text-blue-400">Today</span></span>
                    </a>
                    <p class="mt-2 text-gray-400">Professionele taxiservice in heel Nederland.</p>
                </div>
                <div class="grid grid-cols-2 gap-8 sm:grid-cols-3">
                    <div>
                        <h3 class="font-bold mb-3">Links</h3>
                        <ul class="space-y-2">
                            <li><a href="index.html#booking" class="text-gray-400 hover:text-white">Boek een taxi</a></li>
                            <li><a href="index.html#pricing" class="text-gray-400 hover:text-white">Prijzen</a></li>
                            <li><a href="index.html#about" class="text-gray-400 hover:text-white">Over ons</a></li>
                            <li><a href="index.html#contact" class="text-gray-400 hover:text-white">Contact</a></li>
                        </ul>
                    </div>
                    <div>
                        <h3 class="font-bold mb-3">Contact</h3>
                        <ul class="space-y-2">
                            <li class="text-gray-400">020 261 32 10</li>
                            <li class="text-gray-400">info@taxitoday.nl</li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="mt-8 pt-6 border-t border-gray-700 md:flex md:justify-between">
                <p class="text-gray-400 text-sm">© 2024 TaxiToday. Alle rechten voorbehouden.</p>
                <div class="flex mt-4 md:mt-0 space-x-4">
                    <a href="#" class="text-gray-400 hover:text-white">
                        <i class="fab fa-facebook"></i>
                    </a>
                    <a href="#" class="text-gray-400 hover:text-white">
                        <i class="fab fa-instagram"></i>
                    </a>
                    <a href="#" class="text-gray-400 hover:text-white">
                        <i class="fab fa-twitter"></i>
                    </a>
                </div>
            </div>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Profile page loaded');
            
            // Check if user is logged in, if not redirect to login page
            function checkAuthStatus() {
                const token = getCookie('token') || localStorage.getItem('authToken');
                if (!token) {
                    // Not logged in, redirect to login page
                    window.location.href = 'login.html?redirect=' + encodeURIComponent(window.location.pathname);
                    return false;
                }
                return true;
            }
            
            // Load user data
            function loadUserData() {
                const userData = localStorage.getItem('userData');
                if (userData) {
                    const user = JSON.parse(userData);
                    document.getElementById('profile-name').textContent = user.name || 'Gebruiker';
                    document.getElementById('profile-email').textContent = user.email || '';
                    document.getElementById('welcome-name').textContent = user.name ? user.name.split(' ')[0] + '!' : 'daar!';
                }
            }
            
            // Load booking history from API
            function loadBookingHistory() {
                const token = getCookie('token') || localStorage.getItem('authToken');
                
                fetch('/api/user/bookings', {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    credentials: 'include'
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success && data.bookings) {
                        displayBookings(data.bookings);
                    } else {
                        showBookingError('Geen boekingen gevonden of fout bij ophalen.');
                    }
                })
                .catch(error => {
                    console.error('Error fetching bookings:', error);
                    showBookingError('Er is een fout opgetreden bij het ophalen van uw boekingen.');
                });
            }
            
            // Display bookings in the UI
            function displayBookings(bookings) {
                const container = document.getElementById('bookings-container');
                const template = document.getElementById('booking-template');
                
                // Clear loading state
                container.innerHTML = '';
                
                if (bookings.length === 0) {
                    container.innerHTML = `
                        <div class="text-center py-6 border border-gray-200 rounded-lg">
                            <i class="fas fa-calendar-times text-gray-400 text-3xl mb-2"></i>
                            <p class="text-gray-500">U heeft nog geen boekingen gemaakt.</p>
                            <a href="index.html#booking" class="mt-3 inline-block px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition">
                                <i class="fas fa-plus mr-2"></i> Nieuwe boeking maken
                            </a>
                        </div>
                    `;
                    return;
                }
                
                // Create a fragment to minimize DOM operations
                const fragment = document.createDocumentFragment();
                
                bookings.forEach(booking => {
                    // Clone the template
                    const bookingCard = template.content.cloneNode(true);
                    
                    // Populate with booking data
                    bookingCard.querySelector('.booking-id').textContent = booking.bookingId;
                    
                    // Format date
                    const bookingDate = new Date(booking.date + 'T' + booking.time);
                    const formattedDate = new Intl.DateTimeFormat('nl-NL', {
                        day: 'numeric',
                        month: 'long',
                        year: 'numeric',
                        hour: '2-digit', 
                        minute: '2-digit'
                    }).format(bookingDate);
                    bookingCard.querySelector('.booking-date').textContent = formattedDate;
                    
                    // Price formatting
                    bookingCard.querySelector('.booking-price').textContent = '€' + booking.price.toFixed(2).replace('.', ',');
                    
                    // Set locations
                    bookingCard.querySelector('.booking-pickup').textContent = booking.pickup;
                    bookingCard.querySelector('.booking-destination').textContent = booking.destination;
                    
                    // Set status
                    const statusElement = bookingCard.querySelector('.booking-status');
                    statusElement.textContent = getStatusText(booking.status);
                    statusElement.className = `booking-status px-3 py-1 rounded-full text-xs font-medium ${getStatusClass(booking.status)}`;
                    
                    // Set status indicator color
                    const statusIndicator = bookingCard.querySelector('.status-indicator');
                    statusIndicator.className = `status-indicator w-3 h-3 rounded-full mr-2 ${getStatusIndicatorClass(booking.status)}`;
                    
                    fragment.appendChild(bookingCard);
                });
                
                container.appendChild(fragment);
            }
            
            // Show booking error message
            function showBookingError(message) {
                const container = document.getElementById('bookings-container');
                container.innerHTML = `
                    <div class="text-center py-6 border border-gray-200 rounded-lg">
                        <i class="fas fa-exclamation-circle text-red-500 text-3xl mb-2"></i>
                        <p class="text-gray-700">${message}</p>
                        <button class="mt-3 inline-block px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition">
                            <i class="fas fa-redo mr-2"></i> Probeer opnieuw
                        </button>
                    </div>
                `;
            }
            
            // Helper function to get status text
            function getStatusText(status) {
                const statusMap = {
                    'confirmed': 'Bevestigd',
                    'pending': 'In afwachting',
                    'completed': 'Voltooid',
                    'cancelled': 'Geannuleerd',
                    'in_progress': 'Onderweg'
                };
                return statusMap[status] || 'Onbekend';
            }
            
            // Helper function to get status class
            function getStatusClass(status) {
                const classMap = {
                    'confirmed': 'bg-green-100 text-green-800',
                    'pending': 'bg-yellow-100 text-yellow-800',
                    'completed': 'bg-blue-100 text-blue-800',
                    'cancelled': 'bg-red-100 text-red-800',
                    'in_progress': 'bg-purple-100 text-purple-800'
                };
                return classMap[status] || 'bg-gray-100 text-gray-800';
            }
            
            // Helper function to get status indicator class
            function getStatusIndicatorClass(status) {
                const classMap = {
                    'confirmed': 'bg-green-500',
                    'pending': 'bg-yellow-500',
                    'completed': 'bg-blue-500',
                    'cancelled': 'bg-red-500',
                    'in_progress': 'bg-purple-500'
                };
                return classMap[status] || 'bg-gray-500';
            }
            
            // Logout functionality
            document.querySelectorAll('.logout-btn').forEach(button => {
                button.addEventListener('click', function() {
                    // Call logout API
                    fetch('/api/auth/logout', {
                        method: 'POST',
                        credentials: 'include'
                    })
                    .then(() => {
                        // Clear local storage
                        localStorage.removeItem('authToken');
                        localStorage.removeItem('userData');
                        
                        // Redirect to home page
                        window.location.href = 'index.html';
                    })
                    .catch(error => {
                        console.error('Logout error:', error);
                        // Still clear local storage and redirect
                        localStorage.removeItem('authToken');
                        localStorage.removeItem('userData');
                        window.location.href = 'index.html';
                    });
                });
            });
            
            // Helper function to get cookie
            function getCookie(name) {
                const value = `; ${document.cookie}`;
                const parts = value.split(`; ${name}=`);
                if (parts.length === 2) return parts.pop().split(';').shift();
            }
            
            // Mobile menu toggle
            const mobileMenuBtn = document.getElementById('mobileMenuBtn');
            const mobileMenu = document.getElementById('mobileMenu');
            
            if (mobileMenuBtn && mobileMenu) {
                mobileMenuBtn.addEventListener('click', function() {
                    mobileMenu.classList.toggle('hidden');
                });
            }
            
            // Initialize page
            if (checkAuthStatus()) {
                loadUserData();
                loadBookingHistory();
            }
        });
    </script>
</body>
</html>